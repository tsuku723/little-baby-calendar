# 要求定義（requirements）— 改訂版（初回セットアップ強化・Today画面追加・複数プロフィール対応）

本ドキュメントは、リトルベビーカレンダーの  
**新UX方針（安心・比べない・成長の可視化）** に基づき、  
以下3点の機能追加を反映した最新版要求仕様である：

- 初回セットアップの強化（UX影響最大）
- トップ画面（Today Screen）の新設
- 複数プロフィール（兄弟・双子）対応

---

# 1. アプリ概要

本アプリは、早産・低出生体重児の保護者向けに、  
**実月齢 × 修正月齢を日付単位で可視化し、日々の小さな成長を安心して記録できる仕組み**  
を提供する。

今回の改訂では、

1) 初回入力の迷いを完全に取り除く  
2) 毎日の「安心」を最初に届ける Today 画面を新設  
3) 兄弟・双子でも安全に記録を切り替えられる構造へ拡張  

を主要テーマとする。

---

# 2. 機能要求（MVP＋今回改訂）

## 2.1 機能一覧（MoSCoW 方式）

| ID | 区分 | 要求名 | 概要 |
|----|------|--------|-------|
| R-001 | Must | **初回セットアップ（強化）** | 出生日／予定日の入力を補助機能付きで行う |
| R-001b | Must | **複数プロフィール管理** | 兄弟・双子など複数の子を登録・切替できる |
| R-002 | Must | 修正月齢カレンダー表示 | 実／修の月齢表示を日付ごとに表示 |
| R-003 | Must | 月移動操作 | 前月／翌月／今日へ戻る |
| R-004 | Delete | 詳細表示（セルタップ） | 年齢・日齢・記録の一覧 |
| R-005 | Must | 修正月齢表示上限 | 修正月齢ラベルを表示する上限の月数設定 |
| R-006 | Must | 年齢フォーマット切替 | md／ymd |
| R-007 | Must | 端末内保存 | すべてデータはローカル（AsyncStorage） |
| R-008 | Must | 注意書き表示 | 医療的判断についての注記 |
| R-009 | Should | 最終閲覧月の記憶 | 次回起動時に同じ月を開く |
| R-010 | Should | 記録（旧できた・頑張った）登録 | 「記録」として登録する（名称変更済） |
| R-011 | Should | 記録一覧表示 | 全記録を日付降順で表示 |
| R-012 | Should | 設定画面 | 全設定値の変更 |
| R-013 | Should | 生後日数表示設定 | 日齢 ON/OFF |
| R-014 | Should | カレンダー検索 | 指定年月へジャンプ |
| R-015 | Should | **Today Screen（トップ画面）新設** | 今日の月齢・日齢・記録を表示する |

---

# 3. 改訂された主要機能の詳細仕様

## 3.1 R-001（改訂）初回セットアップ（強化版）

### 入力項目
- 子どもの名前（必須）
- 出生日（必須）  
  - DatePicker 標準UI
  - 未来日は不可
- 出産予定日（任意だが推奨）  
  - 入力した場合、修正月齢計算に利用
  - 出生日より「大幅に未来」は不可（チェック要）
- 修正月齢表示上限  
  - 24か月（既定）／36か月／制限なし
- 年齢表示形式  
  - `md`（既定）／`ymd`

### UX改善ポイント
- 「いつ生まれましたか？」→ DatePicker のみで選択  
- 「予定日は覚えていますか？」→ 任意入力で心理的負担を軽減  
- 入力補助  
  - 最近3年以内の日付を初期カーソル  
  - 予定日 < 出生日の場合、軽い警告を表示

### 保存
- 子ども単位で保存（複数プロフィールに対応）
- 構造例：
```ts
users = [
  {
    id: string,
    name: string,
    birthDate: string,
    dueDate?: string,
    settings: {
      ageFormat: "md" | "ymd",
      correctedAgeLimit: number | "none",
      showDayCount: boolean
    }
  }
]
```

### 完了後の遷移
- **Today Screen（R-015）** へ遷移  
（カレンダーではなく、安心を最初に届ける）

---

## 3.2 R-001b（新規）複数プロフィール管理

### 目的
兄弟・双子を App 内で安全に切り替えられる。

### 要求仕様
- 最大登録人数：3〜5名を想定（制限は設計次第）
- プロフィール項目：  
  - 名前  
  - 出生日  
  - 出産予定日（任意）  
  - 個別設定（表示形式・上限月齢など）
- 現在選択中の子の ID はグローバル管理  
  → `UserContext` を新規設置

### 操作フロー
- Today Screen／設定画面ヘッダーに「子ども選択ボタン」
- メニューから「プロフィール管理」画面  
  - 追加／削除／編集可能

### データ構造（重要）
```ts
{
  users: User[]
  activeUserId: string
  achievements: { [userId: string]: Achievement[] }
}
```

### 成約
- **ユーザー間のデータは完全に独立**  
- 切り替えるたび、カレンダー・Today Screen を再描画する

---

## 3.3 R-015（新規）Today Screen（トップ画面）

### 表示項目
- 子どもの名前
- 今日の日付（YYYY/MM/DD）
- 実月齢（フォーマット準拠）
- 修正月齢（同値の場合は非表示）
- 生後日数（設定 ON 時のみ表示）
- 今日の記録（0件／1件以上）
  - 0件 → 「今日はまだ記録がありません」
  - 1件以上 → 最新の記録を1件表示（タップで一覧）

### 導線
- 「記録する」ボタン → 今日の日付で新規記録を開く
- 「カレンダーを見る」ボタン → CalendarScreen
- 「すべての記録を見る」→ 一覧画面

### 要求
- アプリ起動時の最初の画面とする  
- 複数プロフィール切替に即時対応  
- 月齢計算は CalendarScreen と同じロジックを使用

---

# 4. 従来機能（MVP部分）は基本維持

R-002〜R-014 については従来仕様を維持するが、  
複数プロフィール対応に合わせ以下を修正：

### ● R-002〜014 共通修正点
- **対象データは activeUserId に紐づくものだけを使用**
- 記録の一覧・編集・削除も userId ごとに完全分離
- カレンダーの表示ロジックは従来どおり  
  ただしトップ画面で Today Screen を挟むため導線を再確認

---

# 5. 年齢計算ロジック（変更なし）

既存の仕様を踏襲する（UTC正規化、借用法、同値時の修非表示など）。  
ただし **複数プロフィールごとにロジックを独立して適用** する。

---

# 6. 非機能要求（追加修正あり）

| ID | 区分 | 内容 |
|-----|------|--------|
| NF-001 | Must | オフライン完結 |
| NF-002 | Must | ユーザー登録不要 |
| NF-003 | Must | 広告なし |
| NF-004 | Must | データは端末内保存のみ |
| NF-005 | Must | **初回セットアップを迷わず1分以内で完了可能** |
| NF-006 | Must | 複数プロフィールでも操作の一貫性が保たれること |
| NF-007 | Must | Today Screen は 1秒以内に表示されること |
| NF-008 | Should | 起動時間はストレスにならないレベル |

---

# 7. 受け入れ条件（改訂版・主要項目のみ）

### 初回セットアップ強化
- DatePicker で誤入力が発生しない  
- 必須項目が未入力の場合は保存不可  
- 完了後は Today Screen へ遷移する  

### 複数プロフィール
- 子どもを2名以上登録し、切替が即時反映される  
- データは子どもごとに完全に分離される  
- 記録・カレンダーが混在しない  

### Today Screen
- 今日の実／修月齢が正しく表示される  
- 生後日数は設定に応じて表示／非表示  
- 最新の記録が正しく取得される  

### 従来機能
- 月齢計算が従来仕様と一致  
- タイムゾーン変更でもズレない  
- カレンダーで記録が正しく点表示される  

---

# 8. 将来拡張（今回の改訂では未実装）

- 記録のグラフ化（成長／頑張ったの推移）
- タグ分類の強化（記録種類の追加）
- PWA 化・通知機能
- 写真添付機能
- データエクスポート

---

