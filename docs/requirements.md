# 要求定義（requirements）

## 1. 概要

本ドキュメントは、リトルベビーカレンダー（修正月齢カレンダーアプリ）の  
**MVP段階における機能要求・非機能要求** を整理したものである。

---

## 2. 機能要求（MVP）

### 2.1 機能一覧（MoSCoW）

| ID    | 区分  | 要求名                           | 概要 |
|-------|-------|----------------------------------|------|
| R-001 | Must  | 出生日・出産予定日の入力        | 出生日と出産予定日を入力・保存できること |
| R-002 | Must  | 修正月齢カレンダー表示          | 各日の実月齢・修正月齢をカレンダー上に表示すること |
| R-003 | Must  | 月表示・月移動                  | 前月/翌月への移動、今日に戻る操作ができること |
| R-004 | Must  | 詳細表示（セルタップ）          | 任意の日付をタップすると詳細情報を表示できること |
| R-005 | Must  | 修正月齢表示上限の設定          | 修正月齢の表示上限（月数）を設定できること |
| R-006 | Must  | 年齢表示形式の切替              | md / ymd 表記を切り替えられること |
| R-007 | Must  | データの端末内保存              | 入力情報・設定を端末内に保存し、再起動後も復元できること |
| R-008 | Must  | 注意書き表示                    | 医療的注意・データ保存方針の注記を表示すること |
| R-009 | Could | 最終閲覧月の記憶                | 最後に開いていた月を記憶し、次回起動時に再表示すること |
| R-010 | Should| できた・頑張ったの記録          | 任意の日付ごとに「できた」「頑張った」ことを記録できること |
| R-011 | Should| できた・頑張った一覧表示        | 記録した「できた」「頑張った」ことを一覧で確認できること   |
| R-012 | Should| 設定画面                       | 修正月齢表示上限・年齢表示形式・生後日数表示などの設定を一覧で変更できること|
| R-013 | Should| 生まれてからの日数表示設定       | 詳細画面に「生まれてから何日目か」を表示するかどうかを設定できること |
| R-014 | Should| カレンダー検索                 | 修正月齢カレンダーにて、指定した年月のカレンダーを表示できること |

---

### 2.2 各機能の詳細

#### R-001 出生日・出産予定日の入力（初回セットアップ画面）

- 入力項目
  - 出生日（必須）
  - 出産予定日（任意だが推奨）
  - 修正月齢表示上限（月数）  
    - 選択肢：24か月（既定）、36か月、制限なし
  - 年齢表示形式  
    - 選択肢：`md`（例：2m4d）、`ymd`（例：1y2m4d）／既定は `md`
- 要求
  - 入力した値を端末内ストレージ（例：AsyncStorage）に保存すること
  - 再起動後も設定値が復元されること
  - 入力チェック（必須項目未入力時のエラー表示）が行われること

#### R-002 修正月齢カレンダー表示（月表示）

- レイアウト
  - 7列×5〜6行の月グリッド
  - 上部に年月、前月/翌月、今日へ戻るボタン
- セル表示
  - 1行目：日付
  - 2行目：実月齢 `実: <md/ymd>`
  - 3行目：修正月齢 `修: <md/ymd>`  
    ただし以下の場合は修を非表示とする：
    - 予定日未入力
    - 実月齢と修正月齢が同値
    - 修正月齢が表示上限（月数）を超える場合
  - できた、頑張ったの記録がある場合はセルに「●」を表示する
- 要求
  - 当月／他の月でも、各日の実月齢・修正月齢を正しく計算して表示すること
  - 日付のズレがタイムゾーンの違いで発生しないこと（詳細は「3. 年齢計算ロジック」）

#### R-003 月表示・月移動

- 要求
  - ヘッダー部の操作で前月・翌月に移動できること
  - 「今日へ」ボタンで当月に戻れること
  - 月移動時も計算ロジックが一貫して適用されること
 
#### R-004 詳細表示（セルタップ時）

- セルタップ時に、ボトムシートまたはポップアップで以下を表示：
  - 対象日（YYYY/MM/DD）
  - 実月齢
  - 修正月齢
  - 生まれてから何日目か
- 要求
  - 表示値がカレンダー上のラベルと矛盾しないこと
  - 実/修が同値の日は、その旨が分かる形（例：修非表示）となっていること

#### R-005 修正月齢表示上限の設定

- ユーザーは設定画面または初回セットアップで、以下から選択可能：
  - 24か月（既定）
  - 36か月
  - 制限なし
- 要求
  - 基準日（max(出生日, 出産予定日））から指定月数を超えた日付では、修正月齢を非表示にすること
  - 実月齢表示には影響を与えないこと

#### R-006 年齢表示形式の切替

- 選択肢
  - `md`：月・日のみ（例：2m4d）
  - `ymd`：年・月・日（例：1y2m4d）
- 要求
  - 設定変更後、カレンダー・詳細表示が即座に新しい形式で表示されること
  - 内部の計算ロジックは共通で、フォーマットのみが変わること

#### R-007 データの端末内保存

- 保存対象
  - 出生日、出産予定日
  - 修正月齢表示上限
  - 年齢表示形式
  - 生まれてからの日数表示 ON/OFF（R-013）
  - 最終閲覧月（R-009 を実装する場合）
  - できた・頑張ったの記録
- 要求
  - すべて端末内にのみ保存し、外部サーバには送信しないこと
  - アプリ再起動後も前回の状態を復元できること

#### R-008 注意書き表示

- カレンダー画面のフッター等に、以下の文言を表示：
  - 「修正月齢の表記は目安です。医療的判断は必ず主治医にご相談ください。」
  - 「データは端末内のみで保存します。」
- 要求
  - ユーザーが常に確認できる位置・サイズで表示すること


#### R-010 できた・頑張ったの記録（Should）

- 登録導線
  - カレンダーの日付セルタップ → 詳細表示画面 → 「＋記録する」ボタンから登録する
  - 一覧画面から新規追加はできない（MVPでは閲覧専用）
- 日付ごとに記録できる項目
  - **できた**か**頑張った**か（必須・ラジオボタン）
  - できた／頑張った内容（必須・短いテキスト）
  - メモ（任意・複数行テキスト）
- 挙動
  - 同じ日付に複数件登録可能
  - 登録後、その日付のカレンダーセルに「●」を表示する
- 編集／削除
  - 詳細画面内の一覧から、各記録をタップして編集／削除できること
- 並び順
  - 同じ日付内では作成日時の昇順で表示する
- 要求
  - 入力内容は端末内に保存され、再起動後も保持されること


#### R-011 できた・頑張った一覧表示（Should）

- 導線
  - メイン画面からメニューボタン押下で一覧画面を開く
- 表示
  - すべての記録を「日付の降順」で表示する
  - 各行には以下を表示する
    - 日付
    - 種別（できた／頑張った）
    - タイトル（内容の先頭数十文字）
- フィルタ
  - 全件／できたのみ／頑張ったのみ を切り替え可能
- 制限
  - MVPでは一覧画面から新規追加は行わない（編集・削除は許可してもよい／しなくてもよい。実装コストと相談）
- 要求
  - 一覧に表示される件数が多くなってもクラッシュしないこと
  - 一覧の内容と日付別詳細画面の内容が一致していること

#### R-012 設定画面（Should）

- 導線
  - メイン画面から設定ボタン押下で表示する
- 設定可能な項目
  - 出産予定日（任意・変更可）
  - 出生日
  - 修正月齢表示上限（月数）
  - 年齢表示形式（md / ymd）
  - 生まれてからの日数表示 ON/OFF（R-013）
- 要求
  - 初回セットアップで入力した値と同じ項目を、後から変更できること
  - 設定変更は即座にカレンダー・詳細表示に反映されること
  - 設定値は端末内に保存され、再起動後も保持されること


#### R-013 生まれてからの日数表示設定（Should）

- 設定項目
  - 「生まれてからの日数を表示する」の ON/OFF
    - 選択肢：ON（詳細画面に表示）／OFF（詳細画面で非表示）
- 要求
  - 設定値を端末内に保存し、再起動後も反映されること
  - ON の場合のみ、詳細画面に「生まれてから何日目か」を表示すること
  - OFF の場合は、詳細画面から当該表示を出さないこと

---

## 3. 年齢計算ロジック（厳守仕様）

### 3.1 定義

- 実月齢（chronological age）  
  → `対象日 − 出生日`
- 修正月齢（corrected age）  
  → `対象日 − max(出生日, 出産予定日)`

### 3.2 ケース別の扱い

- 予定日より早く生まれた場合（早産）
  - 基準日 = 予定日
  - 修正月齢 = `対象日 − 予定日`
- 予定日以降の出生（正期産・過期産）
  - 実月齢と修正月齢は常に同値  
  → 修正月齢表示は省略可能（MVPでは非表示）

### 3.3 特記事項

- 負の値（対象日が基準日より前）は **0d に丸める**
- 表記形式：
  - 既定は `md`（例：2m4d）
  - オプションで `ymd`（1y2m4d）
- 実／修が同じ日の場合
  - MVP仕様では「修」のラベルは非表示とする

### 3.4 日付・タイムゾーンの扱い

- 日付は UTC 基準で正規化して扱うこと
  - 例：`Date.UTC(y, m, d)` 相当で日付を丸める
- 端末のタイムゾーンを変更しても、カレンダー上の日付・年齢表示が1日もズレないこと
- 暦差の算出は「借用法」による y/m/d 差分に準拠すること  
  （例：日が足りない場合、前月末日から日数を借りる）

### 3.5 できた・頑張ったのデータ構造

- Achievement レコードは下記の構造とする：

    ```ts
    type Achievement = {
    id: string
    date: ISODateString    // 紐づく日付（UTC丸め）
    type: "did" | "tried"  // できた / 頑張った
    title: string          // 内容（一覧に表示する一行テキスト）
    memo?: string          // メモ（任意）
    createdAt: ISODateString
    }

- 保存形式の例（端末内保存）

    ```ts
    type AchievementStore = {
    achievements: Achievement[]
    }




---

## 4. 非機能要求

| ID    | 区分  | 内容                                       |
|-------|-------|--------------------------------------------|
| NF-001| Must  | オフライン完結（ネット接続不要）          |
| NF-002| Must  | ユーザー登録不要                           |
| NF-003| Must  | 広告なし（MVP）                            |
| NF-004| Must  | データは端末内保存のみ（クラウド送信なし）|
| NF-005| Must  | 初回設定を1分以内で完了できるUI           |
| NF-006| Must  | 主要テキストの文字サイズは12–14pt以上     |
| NF-007| Must  | コントラスト比 4.5:1 以上                  |
| NF-008| Should| 起動時間が体感ストレスにならないレベル     |

---

## 5. 受け入れ条件（主要）

### 5.1 正常系

- ✅ 出生日のみ入力時：
  - カレンダー全日で **実月齢のみ** 表示され、修正月齢は非表示であること。
- ✅ 出生日＋予定日入力時：
  - 予定日前：修正月齢は `0d` として扱われる（表示有無は仕様通り）。  
  - 予定日以降：修正月齢が日数に応じて増加していること。
- ✅ 実月齢と修正月齢が同値の日：
  - カレンダーセルで「修」ラベルが非表示になっていること（MVP仕様）。
- ✅ 表示上限 24か月設定時：
  - 基準日（`max(出生日, 予定日)`）から 24か月を超える日は、修正月齢ラベルが非表示になること。
- ✅ 端末のタイムゾーンを変更しても：
  - カレンダー上の日付・実月齢・修正月齢が 1日もズレないこと。
- ✅ 任意の日付に「できた」「頑張った」を1件以上登録できること
- ✅ 同じ日に「できた」「頑張った」を複数件登録できること
- ✅ 登録した「できた」「頑張った」の内容がアプリ再起動後も保持されること
- ✅ カレンダー上に記録の有無が視覚的に反映されること
- ✅ 「できた」「頑張った」の一覧画面にすべての記録が日付順で表示されること
- ✅ 生まれてからの日数表示を OFF にした場合、詳細画面に「生まれてから何日目か」が表示されないこと
- ✅ 生まれてからの日数表示を ON にした場合、詳細画面に正しい日数が表示されること


### 5.2 テスト用ケース（例）

1. 出生日：`2025-10-01`、予定日：`2025-12-01`（早産）
   - `2025-11-15` → 実：0m15d、修：0d
   - `2025-12-15` → 実：2m14d、修：0m14d
   - `2026-01-15` → 実：3m14d、修：1m14d

2. 出生日：`2025-07-10`、予定日：`2025-07-05`（予定日以降出生）
   - 任意の日付 → 実と修は常に同値（修ラベルは非表示）

---

## 6. 将来拡張（現時点では実装しないが考慮）

- 週齢併記表示（w/d）
- 修正誕生日バッジ（予定日＋1年などマイルストーン表示）
- 身長・体重グラフ（修正月齢軸、WHO参照などは後フェーズ）
- 1行メモ／写真添付（端末内保存、エクスポート機能）
- PWA 化・通知機能（記念日リマインドなど）
